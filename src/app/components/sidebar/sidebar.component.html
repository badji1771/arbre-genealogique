<div class="sidebar-wrapper" [class.collapsed]="collapsed">
  <button
    class="btn-toggle-sidebar"
    (click)="onToggleSidebar()"
    [title]="collapsed ? 'Afficher la barre latérale' : 'Masquer la barre latérale'"
  >
    <span class="btn-icon"><i class="fas" [class.fa-angle-right]="collapsed" [class.fa-angle-left]="!collapsed"></i></span>
  </button>

  <aside class="modern-sidebar" [class.collapsed]="collapsed">
  <div class="sidebar-section">
    <div class="section-header">
      <h3>
        <span class="section-icon"><i class="fas fa-book"></i></span>
        Vos Familles
      </h3>
      <button
        class="btn-add-circle"
        (click)="onToggleAddFamily()"
        [class.active]="showAddFamily"
      >
        <i class="fas fa-plus"></i>
      </button>
    </div>

    <!-- Formulaire d'ajout intégré -->
    <div *ngIf="showAddFamily" class="add-family-card">
      <input
        type="text"
        [(ngModel)]="newFamilyName"
        placeholder="Nom de la nouvelle famille..."
        class="modern-input"
        (keyup.enter)="onAddNewFamily()"
      />
      <div class="card-actions">
        <button type="button" (click)="onAddNewFamily()" class="btn-confirm" aria-label="Créer la famille">
          <span class="btn-icon"><i class="fas fa-check"></i></span>
          Créer
        </button>
        <button (click)="onToggleAddFamily()" class="btn-cancel">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <!-- Liste des familles avec visualisation -->
    <div class="families-container">
      <div
        *ngFor="let family of families"
        class="family-card"
        [class.active]="selectedFamily?.id === family.id"
        [class.editing]="editingFamilyId === family.id"
        (click)="onSelectFamily(family)"
      >
        <div class="card-main">
          <div class="family-avatar">
            <span class="avatar-icon"><i class="fas fa-tree"></i></span>
            <div class="avatar-badge" *ngIf="getFamilyMemberCount(family) > 0">
              {{ getFamilyMemberCount(family) }}
            </div>
          </div>

          <div class="family-info">
            <ng-container *ngIf="editingFamilyId !== family.id; else editMode">
              <h4 class="family-name">{{ family.name }}</h4>
              <div class="family-meta">
                <span class="meta-date"><i class="far fa-calendar-alt"></i> {{ family.createdAt | date:'dd MMM yyyy' }}</span>
              </div>
            </ng-container>

            <ng-template #editMode>
              <div class="edit-container" (click)="$event.stopPropagation()">
                <input
                  type="text"
                  [(ngModel)]="editedFamilyName"
                  (keyup.enter)="saveRename(family, $event)"
                  (keyup.escape)="cancelRename($event)"
                  autoFocus
                  class="edit-input"
                />
                <div class="edit-actions">
                  <button class="btn-save" (click)="saveRename(family, $event)" title="Enregistrer">
                    <i class="fas fa-check"></i>
                  </button>
                  <button class="btn-cancel-edit" (click)="cancelRename($event)" title="Annuler">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
            </ng-template>
          </div>

          <div class="card-actions-hover" *ngIf="editingFamilyId !== family.id">
            <button class="action-btn rename" (click)="startRename(family, $event)" title="Renommer">
              <i class="fas fa-pencil-alt"></i>
            </button>
            <button class="action-btn delete" (click)="onDeleteFamily(family, $event)" title="Supprimer">
              <i class="fas fa-trash-alt"></i>
            </button>
          </div>
        </div>

        <div class="card-footer" *ngIf="editingFamilyId !== family.id">
          <div class="progress-container">
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="Math.min((getFamilyMemberCount(family) / 20) * 100, 100)"></div>
            </div>
          </div>
          <button class="btn-quick-view" type="button" (click)="$event.stopPropagation(); onQuickView(family)" title="Aperçu rapide">
            <i class="fas fa-external-link-alt"></i>
          </button>
        </div>
      </div>

      <!-- État vide visuel -->
      <div *ngIf="families.length === 0" class="empty-state">
        <div class="empty-illustration">
          <div class="illustration-tree">
            <div class="tree-trunk"></div>
            <div class="tree-branches">
              <div class="branch"></div>
              <div class="branch"></div>
              <div class="branch"></div>
            </div>
          </div>
        </div>
        <div class="empty-content">
          <h4>Aucune famille créée</h4>
          <p>Commencez votre premier arbre généalogique</p>
          <button (click)="onToggleAddFamily()" class="btn-start">
            <span class="btn-icon"><i class="fas fa-seedling"></i></span>
            Créer une famille
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Statistiques globales -->
  <div class="sidebar-section stats-section">
    <h3>
      <span class="section-icon"><i class="fas fa-chart-bar"></i></span>
      Vue d'ensemble
    </h3>
    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-icon"><i class="fas fa-users"></i></div>
        <div class="stat-details">
          <div class="stat-value">{{ totalMembersAllFamilies }}</div>
          <div class="stat-label">Personnes totales</div>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon"><i class="fas fa-home"></i></div>
        <div class="stat-details">
          <div class="stat-value">{{ families.length }}</div>
          <div class="stat-label">Familles</div>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon"><i class="fas fa-tree"></i></div>
        <div class="stat-details">
          <div class="stat-value">{{ totalGenerations }}</div>
          <div class="stat-label">Générations</div>
        </div>
      </div>
    </div>
  </div>
  </aside>
</div>
