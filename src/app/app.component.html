<div class="app-container modern-home">
  <!-- Header simplifiÃ© et Ã©lÃ©gant -->
  <header class="modern-header">
    <div class="header-top">
      <div class="logo-container">
        <div class="logo-animated">
          <span class="logo-tree">ğŸŒ³</span>
          <div class="logo-pulse"></div>
        </div>
        <div class="logo-text">
          <h1 class="logo-title">Arbre GÃ©nÃ©alogique</h1>
          <p class="logo-subtitle">Connectez votre histoire familiale</p>
        </div>
      </div>

      <div class="header-actions">
        <button class="btn-import" (click)="triggerImport()">
          <span class="btn-icon">ğŸ“¤</span>
          Importer
        </button>
        <button class="btn-guide" (click)="showGuide()">
          <span class="btn-icon">â“</span>
          Guide
        </button>
      </div>
    </div>

    <!-- Indicateur de famille sÃ©lectionnÃ©e -->
    <div *ngIf="selectedFamily" class="family-indicator">
      <div class="indicator-content">
        <div class="indicator-icon">ğŸ </div>
        <div class="indicator-info">
          <h3>{{ selectedFamily.name }}</h3>
          <div class="indicator-stats">
            <span class="stat">ğŸ‘¥ {{ getTotalMembers(selectedFamily) }} membres</span>
            <span class="stat">ğŸŒ³ {{ maxLevel + 1 }} gÃ©nÃ©rations</span>
            <span class="stat">ğŸ“… {{ selectedFamily.createdAt | date:'dd/MM/yyyy' }}</span>
          </div>
        </div>
      </div>
      <button class="btn-action-primary" (click)="openJsonManager()">
        <span class="btn-icon">ğŸ’¾</span>
        GÃ©rer les donnÃ©es
      </button>
    </div>
  </header>

  <!-- Contenu principal redessinÃ© -->
  <main class="modern-main">
    <!-- Sidebar des familles amÃ©liorÃ©e -->
    <aside class="modern-sidebar">
      <div class="sidebar-section">
        <div class="section-header">
          <h3>
            <span class="section-icon">ğŸ“š</span>
            Vos Familles
          </h3>
          <button
            class="btn-add-circle"
            (click)="showAddFamily = !showAddFamily"
            [class.active]="showAddFamily"
          >
            +
          </button>
        </div>

        <!-- Formulaire d'ajout intÃ©grÃ© -->
        <div *ngIf="showAddFamily" class="add-family-card">
          <input
            type="text"
            [(ngModel)]="newFamilyName"
            placeholder="Nom de la nouvelle famille..."
            class="modern-input"
            (keyup.enter)="addNewFamily()"
          />
          <div class="card-actions">
            <button (click)="addNewFamily()" class="btn-confirm">
              <span class="btn-icon">âœ“</span>
              CrÃ©er
            </button>
            <button (click)="showAddFamily = false" class="btn-cancel">
              âœ•
            </button>
          </div>
        </div>

        <!-- Liste des familles avec visualisation -->
        <div class="families-container">
          <div
            *ngFor="let family of families"
            class="family-card"
            [class.active]="selectedFamily?.id === family.id"
            (click)="selectFamily(family)"
          >
            <div class="card-header">
              <div class="family-avatar">
                <span class="avatar-icon">ğŸ </span>
                <div class="avatar-progress">
                  <div
                    class="progress-fill"
                    [style.width.%]="(family.members.length / 50) * 100"
                  ></div>
                </div>
              </div>
              <div class="family-meta">
                <h4>{{ family.name }}</h4>
                <div class="meta-info">
                  <span class="info-item">
                    <span class="info-icon">ğŸ‘¤</span>
                    {{ family.members.length }}
                  </span>
                  <span class="info-item">
                    <span class="info-icon">ğŸ“…</span>
                    {{ family.createdAt | date:'dd/MM' }}
                  </span>
                </div>
              </div>
            </div>

            <div class="card-preview">
              <div class="preview-tree">
                <div class="tree-level" *ngFor="let level of [1,2,3]"></div>
              </div>
              <button class="btn-quick-view" (click)="quickView(family)">
                ğŸ‘ï¸
              </button>
            </div>
          </div>

          <!-- Ã‰tat vide visuel -->
          <div *ngIf="families.length === 0" class="empty-state">
            <div class="empty-illustration">
              <div class="illustration-tree">
                <div class="tree-trunk"></div>
                <div class="tree-branches">
                  <div class="branch"></div>
                  <div class="branch"></div>
                  <div class="branch"></div>
                </div>
              </div>
            </div>
            <div class="empty-content">
              <h4>Aucune famille crÃ©Ã©e</h4>
              <p>Commencez votre premier arbre gÃ©nÃ©alogique</p>
              <button (click)="showAddFamily = true" class="btn-start">
                <span class="btn-icon">ğŸŒ±</span>
                CrÃ©er une famille
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Statistiques globales -->
      <div class="sidebar-section stats-section">
        <h3>
          <span class="section-icon">ğŸ“Š</span>
          Vue d'ensemble
        </h3>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-icon">ğŸ‘¥</div>
            <div class="stat-details">
              <div class="stat-value">{{ getTotalMembersAllFamilies() }}</div>
              <div class="stat-label">Personnes totales</div>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-icon">ğŸ </div>
            <div class="stat-details">
              <div class="stat-value">{{ families.length }}</div>
              <div class="stat-label">Familles</div>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-icon">ğŸŒ³</div>
            <div class="stat-details">
              <div class="stat-value">{{ getTotalGenerations() }}</div>
              <div class="stat-label">GÃ©nÃ©rations</div>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Zone centrale principale -->
    <section class="main-content">
      <!-- Vue d'accueil amÃ©liorÃ©e -->
      <div *ngIf="!selectedFamily" class="welcome-dashboard">
        <div class="dashboard-hero">
          <div class="hero-content">
            <div class="hero-animation">
              <div class="family-tree-animation">
                <div class="tree">
                  <div class="level" *ngFor="let level of [1,2,3,4]"></div>
                </div>
                <div class="members">
                  <div class="member" style="top: 20%; left: 50%;">ğŸ‘¨</div>
                  <div class="member" style="top: 40%; left: 30%;">ğŸ‘©</div>
                  <div class="member" style="top: 40%; left: 70%;">ğŸ‘¨</div>
                  <div class="member" style="top: 60%; left: 20%;">ğŸ‘¦</div>
                  <div class="member" style="top: 60%; left: 50%;">ğŸ‘§</div>
                  <div class="member" style="top: 60%; left: 80%;">ğŸ‘¶</div>
                </div>
              </div>
            </div>

            <div class="hero-text">
              <h2>PrÃ©servez votre hÃ©ritage familial</h2>
              <p class="hero-description">
                CrÃ©ez, visualisez et partagez votre arbre gÃ©nÃ©alogique
                avec une interface moderne et intuitive
              </p>

              <div class="hero-actions">
                <button (click)="createFirstFamily()" class="btn-hero-primary">
                  <span class="btn-icon">ğŸŒ³</span>
                  DÃ©marrer mon arbre
                </button>
                <button (click)="openSample()" class="btn-hero-secondary">
                  <span class="btn-icon">ğŸ‘ï¸</span>
                  Voir un exemple
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- FonctionnalitÃ©s principales -->
        <div class="features-grid">
          <div class="feature-card">
            <div class="feature-icon">ğŸ‘¥</div>
            <h4>Ajout intuitif</h4>
            <p>Ajoutez des membres facilement avec des formulaires intelligents</p>
          </div>

          <div class="feature-card">
            <div class="feature-icon">ğŸ“Š</div>
            <h4>Export complet</h4>
            <p>Exportez vos donnÃ©es en Excel, PDF et JSON</p>
          </div>

          <div class="feature-card">
            <div class="feature-icon">ğŸ¨</div>
            <h4>Visualisation</h4>
            <p>Plusieurs vues pour explorer votre arbre</p>
          </div>

          <div class="feature-card">
            <div class="feature-icon">ğŸ“±</div>
            <h4>Multi-plateforme</h4>
            <p>AccÃ©dez Ã  votre arbre depuis tous vos appareils</p>
          </div>
        </div>

        <!-- DÃ©marrage rapide -->
        <div class="quick-start">
          <h3>Commencez rapidement</h3>
          <div class="quick-options">
            <button class="quick-option" (click)="startWithTemplate('simple')">
              <span class="option-icon">ğŸŒ±</span>
              <div class="option-content">
                <h5>Arbre simple</h5>
                <p>DÃ©marrez avec une structure basique</p>
              </div>
              <span class="option-arrow">â†’</span>
            </button>

            <button class="quick-option" (click)="importFromGedcom()">
              <span class="option-icon">ğŸ“¤</span>
              <div class="option-content">
                <h5>Importer GEDCOM</h5>
                <p>Importez un arbre existant</p>
              </div>
              <span class="option-arrow">â†’</span>
            </button>

            <button class="quick-option" (click)="openTutorial()">
              <span class="option-icon">ğŸ“</span>
              <div class="option-content">
                <h5>Guide pas Ã  pas</h5>
                <p>Apprenez Ã  crÃ©er votre arbre</p>
              </div>
              <span class="option-arrow">â†’</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Vue famille sÃ©lectionnÃ©e -->
      <div *ngIf="selectedFamily" class="family-dashboard">
        <!-- En-tÃªte famille -->
        <div class="family-header">
          <div class="header-main">
            <div class="breadcrumb">
              <span class="crumb" (click)="selectedFamily = null">Familles</span>
              <span class="separator">â€º</span>
              <span class="crumb active">{{ selectedFamily.name }}</span>
            </div>

            <!-- Dans la section header-actions du family-header -->
            <div class="header-actions">
              <!-- Bouton Ajouter un membre amÃ©liorÃ© -->
              <div class="add-member-container">
                <button
                  (click)="openAddPersonModal()"
                  class="btn-add-member"
                >
                  <div class="btn-add-content">
                    <span class="btn-add-icon">ğŸ‘¤</span>
                    <div class="btn-add-text">
                      <span class="btn-add-title">Ajouter un membre</span>
                      <span class="btn-add-subtitle">Cliquez pour ajouter</span>
                    </div>
                    <span class="btn-add-arrow">â•</span>
                  </div>
                  <div class="btn-add-glow"></div>
                </button>

                <!-- Menu rapide d'ajout (optionnel) -->
                <div class="quick-add-menu">
                  <button (click)="openAddPersonModal()" class="quick-add-item">
                    <span class="quick-add-icon">ğŸ‘¤</span>
                    <span class="quick-add-label">Personne seule</span>
                  </button>
                  <button (click)="openAddPersonModal()" class="quick-add-item">
                    <span class="quick-add-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
                    <span class="quick-add-label">Famille</span>
                  </button>
                  <button (click)="openAddPersonModal()" class="quick-add-item">
                    <span class="quick-add-icon">ğŸ‘¶</span>
                    <span class="quick-add-label">Enfant</span>
                  </button>
                </div>
              </div>

              <!-- Bouton Actions avec ouverture au clic -->
              <div class="actions-container" [class.has-open-menu]="isActionsMenuOpen">
                <button class="btn-actions"
                        (click)="toggleActionsMenu($event)"
                        [class.active]="isActionsMenuOpen">
                  <div class="btn-actions-content">
                    <span class="btn-actions-icon">âš¡</span>
                    <span class="btn-actions-text">Actions</span>
                    <span class="btn-actions-arrow">â–¼</span>
                  </div>
                </button>
              </div>
            </div>
          </div>

          <!-- Statistiques famille -->
          <div class="family-stats">
            <div class="stat-card">
              <div class="stat-trend" [class.positive]="getGrowthTrend() > 0">
                {{ getGrowthTrend() > 0 ? 'â†—' : 'â†’' }}
              </div>
              <div class="stat-main">
                <div class="stat-value">{{ selectedFamily.members.length }}</div>
                <div class="stat-label">Membres</div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-main">
                <div class="stat-value">{{ maxLevel + 1 }}</div>
                <div class="stat-label">GÃ©nÃ©rations</div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-main">
                <div class="stat-value">{{ getGenderCount('homme') }}</div>
                <div class="stat-label">Hommes</div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-main">
                <div class="stat-value">{{ getGenderCount('femme') }}</div>
                <div class="stat-label">Femmes</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Vues de l'arbre -->
        <div class="view-controls-container">
          <div class="view-selector-group">
            <!-- SÃ©lecteur de vue principal -->
            <div class="view-picker">
              <span class="view-picker-label">Vue :</span>
              <div class="view-picker-buttons">
                <button
                  class="view-picker-btn"
                  [class.active]="currentView === 'tree'"
                  (click)="setView('tree')"
                  data-view="tree"
                  title="Vue arbre classique"
                >
                  <span class="view-icon">ğŸŒ³</span>
                  <span class="view-label">Arbre</span>
                  <span class="view-badge" *ngIf="getVisibleLevelsCount()">
            {{ getVisibleLevelsCount() }}
          </span>
                </button>

                <button
                  class="view-picker-btn"
                  [class.active]="currentView === 'list'"
                  (click)="setView('list')"
                  data-view="list"
                  title="Vue liste des membres"
                >
                  <span class="view-icon">ğŸ“‹</span>
                  <span class="view-label">Liste</span>
                  <span class="view-badge">{{ getAllMembersFlat().length }}</span>
                </button>

                <button
                  class="view-picker-btn coming-soon"
                  [class.active]="currentView === 'timeline'"
                  (click)="setView('timeline')"
                  data-view="timeline"
                  title="Vue chronologique (bientÃ´t)"
                >
                  <span class="view-icon">ğŸ“…</span>
                  <span class="view-label">Chronologie</span>
                  <span class="view-badge">ğŸš§</span>
                </button>

                <button
                  class="view-picker-btn coming-soon"
                  [class.active]="currentView === 'map'"
                  (click)="setView('map')"
                  data-view="map"
                  title="Vue carte gÃ©ographique (bientÃ´t)"
                >
                  <span class="view-icon">ğŸ—ºï¸</span>
                  <span class="view-label">Carte</span>
                  <span class="view-badge">ğŸš§</span>
                </button>
              </div>
            </div>

            <!-- ContrÃ´les d'expansion/contraction -->
            <div class="expansion-controls">
              <!-- Groupe compact pour les deux boutons -->
              <div class="expansion-group compact">
                <button
                  class="expansion-btn btn-expand-all"
                  (click)="expandAll()"
                  [disabled]="!selectedFamily || selectedFamily.members.length === 0"
                  title="Tout dÃ©velopper (Ctrl + E)"
                >
                  <div class="expansion-icon">
                    <svg class="expand-svg" viewBox="0 0 24 24">
                      <path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"/>
                      <path d="M0 0h24v24H0z" fill="none"/>
                    </svg>
                  </div>
                  <span class="expansion-label">Ouvrir tout</span>
                </button>

                <button
                  class="expansion-btn btn-collapse-all"
                  (click)="collapseAll()"
                  [disabled]="!selectedFamily || selectedFamily.members.length === 0"
                  title="Tout rÃ©duire (Ctrl + C)"
                >
                  <div class="expansion-icon">
                    <svg class="collapse-svg" viewBox="0 0 24 24">
                      <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/>
                      <path d="M0 0h24v24H0z" fill="none"/>
                    </svg>
                  </div>
                  <span class="expansion-label">Fermer tout</span>
                </button>
              </div>

              <!-- Indicateur d'Ã©tat -->
              <div class="expansion-state" *ngIf="selectedFamily">
                <div class="state-indicator">
                  <div class="state-bar">
                    <div class="state-fill" [style.width.%]="getExpansionProgress()"></div>
                  </div>
                  <span class="state-text">
        {{ getExpandedLevelsCount() }}/{{ maxLevel + 1 }} gÃ©nÃ©rations
      </span>
                </div>
              </div>
            </div>

            <!-- Options rapides pour l'arbre -->
            <div class="quick-controls" *ngIf="currentView === 'tree' && selectedFamily">
              <button
                class="quick-btn"
                (click)="toggleShowAllGenerations()"
                [class.active]="showAllGenerations"
                title="Basculer l'affichage des gÃ©nÃ©rations"
              >
                <span class="quick-icon">{{ showAllGenerations ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}</span>
                <span class="quick-label">
          {{ showAllGenerations ? 'Toutes' : 'SÃ©lectives' }}
        </span>
              </button>

              <button
                class="quick-btn"
                (click)="scrollToGeneration(0)"
                [disabled]="!hasMembersInLevel(0)"
                title="Aller aux fondateurs"
              >
                <span class="quick-icon">ğŸ‘‘</span>
                <span class="quick-label">Fondateurs</span>
              </button>

              <button
                class="quick-btn"
                (click)="scrollToGeneration(maxLevel)"
                [disabled]="!hasMembersInLevel(maxLevel)"
                title="Aller Ã  la derniÃ¨re gÃ©nÃ©ration"
              >
                <span class="quick-icon">ğŸ‘¶</span>
                <span class="quick-label">DerniÃ¨re</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Contenu de la vue -->
        <div class="view-content">
          <div *ngIf="selectedFamily.members.length === 0" class="empty-family">
            <div class="empty-illustration">
              <div class="illustration-content">
                <div class="tree-placeholder">
                  <div class="trunk"></div>
                  <div class="branches">
                    <div class="branch"></div>
                    <div class="branch"></div>
                    <div class="branch"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="empty-message">
              <h3>Votre arbre est vide</h3>
              <p>Ajoutez le premier membre pour commencer Ã  construire votre histoire familiale</p>
              <button (click)="openAddPersonModal()" class="btn-start-tree">
                <span class="btn-icon">ğŸ‘‘</span>
                Ajouter le fondateur
              </button>
            </div>
          </div>

          <!-- Vue arbre gÃ©nÃ©alogique -->
          <ng-container *ngIf="selectedFamily.members.length > 0 && currentView === 'tree'">
            <div class="tree-view modern-tree" #treeContainer>
              <div class="tree-wrapper">
                <!-- Barre latÃ©rale des gÃ©nÃ©rations -->
                <div class="generation-sidebar">
                  <div
                    *ngFor="let level of getGenerationLevels()"
                    class="generation-marker"
                    [class.visible]="!isLevelCollapsed(level)"
                    (click)="scrollToGeneration(level)"
                    [title]="getLevelInfo(level)"
                  >
                    <span class="marker-number">G{{ level + 1 }}</span>
                    <span class="marker-line"></span>
                  </div>
                </div>

                <!-- Contenu des gÃ©nÃ©rations -->
                <div class="generations-content">
                  <div
                    *ngFor="let level of getGenerationLevels()"
                    [id]="'generation-' + level"
                    class="generation-level"
                    [class.collapsed]="isLevelCollapsed(level)"
                  >
                    <!-- En-tÃªte de gÃ©nÃ©ration -->
                    <div *ngIf="!isLevelCollapsed(level)" class="level-header">
                      <div class="level-title">
                        <span class="title-icon">{{ getGenerationIcon(level) }}</span>
                        <h3>{{ getGenerationTitle(level) }}</h3>
                        <span class="level-count">{{ getMemberCountByLevel(level) }} membre(s)</span>
                      </div>
                      <button (click)="toggleLevel(level)" class="btn-toggle">
                        {{ isLevelCollapsed(level) ? 'Afficher' : 'Masquer' }}
                      </button>
                    </div>

                    <!-- Contenu de gÃ©nÃ©ration -->
                    <div *ngIf="!isLevelCollapsed(level)" class="level-content">
                      <div class="members-grid">
                        <ng-container *ngFor="let node of getNodesByLevel(level)">
                          <div class="member-node">
                            <!-- Connexion parent -->
                            <div *ngIf="level > 0" class="parent-connection">
                              <div class="connection-line"></div>
                              <div class="connection-arrow">â†“</div>
                            </div>

                            <!-- Carte personne -->
                            <app-person-card
                              [person]="node.person"
                              [isSelected]="node.isSelected"
                              [generation]="level"
                              (select)="selectedPerson = $event"
                              (addChild)="openAddPersonModal($event)"
                              (edit)="openEditPersonModal($event)"
                              (delete)="deletePerson($event)"
                              (viewDetails)="onViewDetails($event)"
                            ></app-person-card>

                            <!-- Indicateur enfants -->
                            <div
                              *ngIf="node.children && node.children.length > 0"
                              class="children-indicator"
                              (click)="scrollToGeneration(level + 1)"
                            >
                              <span class="indicator-icon">â¬‡ï¸</span>
                              <span class="indicator-text">{{ node.children.length }} enfant(s)</span>
                            </div>
                          </div>
                        </ng-container>
                      </div>

                      <!-- GÃ©nÃ©ration vide -->
                      <div *ngIf="getMemberCountByLevel(level) === 0" class="empty-generation">
                        <span class="empty-icon">ğŸ‘¥</span>
                        <p>Aucun membre dans cette gÃ©nÃ©ration</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>

          <!-- Vue liste -->
          <ng-container *ngIf="selectedFamily.members.length > 0 && currentView === 'list'">
            <div class="list-view">
              <div class="list-header">
                <h3>Liste des membres</h3>
                <div class="list-stats">
                  {{ getTotalMembers(selectedFamily) }} membres
                </div>
              </div>
              <div class="members-list">
                <div *ngFor="let person of getAllMembersFlat()" class="list-item">
                  <div class="list-item-avatar">
                    {{ person.prenom.charAt(0) }}{{ person.nom.charAt(0) }}
                  </div>
                  <div class="list-item-content">
                    <h4>{{ person.prenom }} {{ person.nom }}</h4>
                    <div class="list-item-meta">
                      <span class="meta-item">{{ person.genre === 'homme' ? 'ğŸ‘¨' : 'ğŸ‘©' }}</span>
                      <span class="meta-item">G{{ getPersonGeneration(person) + 1 }}</span>
                      <span *ngIf="person.telephone" class="meta-item">ğŸ“± {{ person.telephone }}</span>
                    </div>
                  </div>
                  <div class="list-item-actions">
                    <button (click)="onViewDetails(person)" class="btn-action">ğŸ‘ï¸</button>
                    <button (click)="openEditPersonModal(person)" class="btn-action">âœï¸</button>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>

          <!-- Vue chronologie -->
          <ng-container *ngIf="selectedFamily.members.length > 0 && currentView === 'timeline'">
            <div class="timeline-view">
              <div class="timeline-empty">
                <div class="empty-icon">ğŸ“…</div>
                <h3>Chronologie</h3>
                <p>FonctionnalitÃ© Ã  venir</p>
              </div>
            </div>
          </ng-container>

          <!-- Vue carte -->
          <ng-container *ngIf="selectedFamily.members.length > 0 && currentView === 'map'">
            <div class="map-view">
              <div class="map-empty">
                <div class="empty-icon">ğŸ—ºï¸</div>
                <h3>Carte gÃ©ographique</h3>
                <p>FonctionnalitÃ© Ã  venir</p>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </section>
  </main>

  <!-- Barre latÃ©rale contextuelle des dÃ©tails personne -->
  <aside class="context-sidebar" [class.visible]="selectedPerson">
    <div *ngIf="selectedPerson" class="sidebar-content">
      <!-- En-tÃªte avec fond colorÃ© -->
      <div class="sidebar-header" [class]="selectedPerson.genre === 'homme' ? 'header-man' : 'header-woman'">
        <div class="header-content">
          <h3>
            <span class="header-icon">ğŸ“‹</span>
            DÃ©tails du membre
          </h3>
          <p class="header-subtitle">{{ selectedPerson.prenom }} {{ selectedPerson.nom }}</p>
        </div>
        <div class="header-actions">
          <button (click)="openEditPersonModal(selectedPerson)" class="header-btn" title="Modifier">
            <span class="btn-icon">âœï¸</span>
            Modifier
          </button>
          <button (click)="selectedPerson = null" class="header-btn header-close" title="Fermer">
            âœ•
          </button>
        </div>
      </div>

      <div class="person-details">
        <!-- Carte profil avec photo/avatar -->
        <div class="profile-card">
          <div class="profile-avatar" [class]="selectedPerson.genre === 'homme' ? 'avatar-man' : 'avatar-woman'">
            <div *ngIf="!selectedPerson.photo" class="avatar-initials">
              {{ getPersonDetails(selectedPerson).initials }}
            </div>
            <img *ngIf="selectedPerson.photo"
                 [src]="selectedPerson.photo"
                 [alt]="selectedPerson.prenom + ' ' + selectedPerson.nom"
                 class="avatar-photo">
            <div class="avatar-badge">
              {{ selectedPerson.genre === 'homme' ? 'ğŸ‘¨' : 'ğŸ‘©' }}
            </div>
          </div>

          <div class="profile-info">
            <h4 class="profile-name">{{ selectedPerson.prenom }} {{ selectedPerson.nom }}</h4>
            <div class="profile-meta">
            <span class="meta-badge generation-badge">
              <span class="meta-icon">ğŸŒ³</span>
              GÃ©nÃ©ration {{ getPersonGeneration(selectedPerson) + 1 }}
            </span>
              <span class="meta-badge id-badge">
              <span class="meta-icon">ğŸ†”</span>
              ID: {{ selectedPerson.id }}
            </span>
            </div>

            <!-- MÃ©triques rapides -->
            <div class="profile-stats">
              <div class="stat-item">
                <div class="stat-icon">ğŸ‘¶</div>
                <div class="stat-details">
                  <div class="stat-value">{{ selectedPerson.children?.length || 0 }}</div>
                  <div class="stat-label">Enfants</div>
                </div>
              </div>
              <div class="stat-item">
                <div class="stat-icon">ğŸ‚</div>
                <div class="stat-details">
                  <div class="stat-value">{{ getAgeFromDate(selectedPerson.dateNaissance) || '?' }}</div>
                  <div class="stat-label">Ã‚ge</div>
                </div>
              </div>
              <div class="stat-item">
                <div class="stat-icon">ğŸ’¼</div>
                <div class="stat-details">
                  <div class="stat-value">{{ selectedPerson.profession ? 'Oui' : 'Non' }}</div>
                  <div class="stat-label">Profession</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions principales avec boutons colorÃ©s -->
        <div class="quick-actions-section">
          <h5 class="section-title">
            <span class="section-icon">âš¡</span>
            Actions rapides
          </h5>
          <div class="actions-grid">
            <button (click)="openAddPersonModal(selectedPerson)" class="action-btn btn-primary">
              <span class="action-icon">ğŸ‘¶</span>
              <span class="action-text">Ajouter un enfant</span>
              <span class="action-arrow">â†’</span>
            </button>

            <button (click)="openEditPersonModal(selectedPerson)" class="action-btn btn-secondary">
              <span class="action-icon">âœï¸</span>
              <span class="action-text">Modifier</span>
              <span class="action-arrow">â†’</span>
            </button>

            <button (click)="downloadPersonPhoto(selectedPerson)"
                    [disabled]="!selectedPerson.photo"
                    class="action-btn btn-success">
              <span class="action-icon">ğŸ“¥</span>
              <span class="action-text">TÃ©lÃ©charger photo</span>
              <span class="action-arrow">â†’</span>
            </button>

            <button (click)="sharePerson(selectedPerson)" class="action-btn btn-info">
              <span class="action-icon">â†—ï¸</span>
              <span class="action-text">Partager</span>
              <span class="action-arrow">â†’</span>
            </button>
          </div>
        </div>

        <!-- Informations de contact -->
        <div class="contact-section" *ngIf="selectedPerson.telephone || selectedPerson.email || selectedPerson.adresse">
          <h5 class="section-title">
            <span class="section-icon">ğŸ“</span>
            Contact
          </h5>
          <div class="contact-list">
            <div *ngIf="selectedPerson.telephone" class="contact-item">
              <div class="contact-icon-wrapper phone">
                <span class="contact-icon">ğŸ“±</span>
              </div>
              <div class="contact-details">
                <span class="contact-label">TÃ©lÃ©phone</span>
                <a [href]="'tel:' + selectedPerson.telephone" class="contact-value">
                  {{ selectedPerson.telephone }}
                </a>
              </div>
              <button (click)="copyToClipboard(selectedPerson.telephone)" class="contact-action" title="Copier">
                ğŸ“‹
              </button>
            </div>

            <div *ngIf="selectedPerson.email" class="contact-item">
              <div class="contact-icon-wrapper email">
                <span class="contact-icon">ğŸ“§</span>
              </div>
              <div class="contact-details">
                <span class="contact-label">Email</span>
                <a [href]="'mailto:' + selectedPerson.email" class="contact-value">
                  {{ selectedPerson.email }}
                </a>
              </div>
              <button (click)="copyToClipboard(selectedPerson.email)" class="contact-action" title="Copier">
                ğŸ“‹
              </button>
            </div>

            <div *ngIf="selectedPerson.adresse" class="contact-item">
              <div class="contact-icon-wrapper address">
                <span class="contact-icon">ğŸ“</span>
              </div>
              <div class="contact-details">
                <span class="contact-label">Adresse</span>
                <span class="contact-value">{{ selectedPerson.adresse }}</span>
              </div>
              <button (click)="openMap(selectedPerson.adresse)" class="contact-action" title="Voir sur carte">
                ğŸ—ºï¸
              </button>
            </div>
          </div>
        </div>

        <!-- Famille -->
        <div class="family-section">
          <!-- Enfants -->
          <div *ngIf="selectedPerson.children && selectedPerson.children.length > 0" class="family-relations">
            <h5 class="section-title">
              <span class="section-icon">ğŸ‘¶</span>
              Enfants ({{ selectedPerson.children.length }})
            </h5>
            <div class="children-list">
              <div *ngFor="let child of selectedPerson.children"
                   class="child-item"
                   (click)="selectedPerson = child">
                <div class="child-avatar" [class]="child.genre === 'homme' ? 'child-boy' : 'child-girl'">
                  {{ child.prenom.charAt(0) }}{{ child.nom.charAt(0) }}
                </div>
                <div class="child-info">
                  <span class="child-name">{{ child.prenom }} {{ child.nom }}</span>
                  <div class="child-meta">
                    <span class="child-gender">{{ child.genre === 'homme' ? 'ğŸ‘¦' : 'ğŸ‘§' }}</span>
                    <span class="child-age">{{ getAgeFromDate(child.dateNaissance) || '?' }} ans</span>
                  </div>
                </div>
                <button class="child-action" title="Voir">
                  ğŸ‘ï¸
                </button>
              </div>
            </div>
          </div>

          <!-- Parent -->
          <div *ngIf="selectedPerson.parentId" class="family-relations">
            <h5 class="section-title">
              <span class="section-icon">ğŸ‘¤</span>
              Parent
            </h5>
            <div class="parent-item" (click)="navigateToParent(selectedPerson.parentId)">
              <div class="parent-avatar">ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦</div>
              <div class="parent-info">
                <span class="parent-name">{{ getParentName(selectedPerson.parentId) }}</span>
                <span class="parent-relation">Parent</span>
              </div>
              <button class="parent-action" title="Voir le parent">
                â†—ï¸
              </button>
            </div>
          </div>
        </div>

        <!-- Notes -->
        <div *ngIf="selectedPerson.notes" class="notes-section">
          <h5 class="section-title">
            <span class="section-icon">ğŸ“</span>
            Notes
          </h5>
          <div class="notes-content">
            {{ selectedPerson.notes }}
          </div>
        </div>

        <!-- Boutons d'action secondaires -->
        <div class="secondary-actions">
          <button (click)="duplicatePerson(selectedPerson)" class="secondary-btn btn-warning">
            <span class="btn-icon">â˜</span>
            Dupliquer
          </button>
          <button (click)="exportPersonData(selectedPerson)" class="secondary-btn btn-info">
            <span class="btn-icon">ğŸ“„</span>
            Exporter fiche
          </button>
          <button (click)="deletePerson(selectedPerson.id)" class="secondary-btn btn-danger">
            <span class="btn-icon">ğŸ—‘ï¸</span>
            Supprimer
          </button>
        </div>
      </div>
    </div>
  </aside>

  <!-- Navigation rapide -->
  <nav class="quick-nav">
    <button class="nav-btn" (click)="scrollToTop()" title="Haut">
      <span class="nav-icon">â†‘</span>
    </button>
    <div class="nav-separator"></div>
    <button class="nav-btn" (click)="toggleSidebar()" title="Familles">
      <span class="nav-icon">ğŸ </span>
    </button>
    <div class="nav-separator"></div>
    <button class="nav-btn" (click)="addQuickPerson()" title="Ajouter rapidement">
      <span class="nav-icon">+</span>
    </button>
    <div class="nav-separator"></div>
    <button class="nav-btn" (click)="searchPersons()" title="Rechercher">
      <span class="nav-icon">ğŸ”</span>
    </button>
    <div class="nav-separator"></div>
    <button class="nav-btn" (click)="scrollToBottom()" title="Bas">
      <span class="nav-icon">â†“</span>
    </button>
  </nav>

  <!-- Notifications toast -->
  <div class="toast-container">
    <div *ngFor="let toast of toasts" class="toast" [class]="toast.type">
      <span class="toast-icon">{{ toast.icon }}</span>
      <span class="toast-message">{{ toast.message }}</span>
      <button class="toast-close" (click)="dismissToast(toast)">Ã—</button>
    </div>
  </div>

  <!-- Menu Actions (placÃ© Ã  la racine pour le z-index) -->
  <div class="actions-dropdown-overlay" #globalDropdown (click)="closeActionsMenu($event)"
       [class.visible]="isActionsMenuOpen">
    <div class="actions-dropdown-content" (click)="$event.stopPropagation()">
      <!-- Bouton de fermeture -->
      <button class="dropdown-close-btn" (click)="closeActionsMenu($event)" title="Fermer">
        âœ•
      </button>

      <!-- En-tÃªte du menu -->
      <div class="dropdown-header">
        <span class="dropdown-icon">ğŸ“‹</span>
        <span class="dropdown-title">Actions rapides</span>
      </div>

      <!-- Sections du menu -->
      <div class="dropdown-section">
        <h6 class="section-title">Export</h6>
        <button (click)="exportCurrentFamily(); closeActionsMenu()" class="dropdown-item">
          <span class="item-icon">ğŸ“Š</span>
          <span class="item-text">Exporter Excel</span>
          <span class="item-badge">Nouveau</span>
        </button>
        <button (click)="exportToJson(); closeActionsMenu()" class="dropdown-item">
          <span class="item-icon">ğŸ’¾</span>
          <span class="item-text">Exporter JSON</span>
        </button>
        <button (click)="exportStatistics(); closeActionsMenu()" class="dropdown-item">
          <span class="item-icon">ğŸ“ˆ</span>
          <span class="item-text">Statistiques</span>
        </button>
      </div>

      <div class="dropdown-section">
        <h6 class="section-title">Gestion</h6>
        <button (click)="duplicateFamily(); closeActionsMenu()" class="dropdown-item">
          <span class="item-icon">â˜</span>
          <span class="item-text">Dupliquer famille</span>
        </button>
        <button (click)="shareFamilyViaMenu(); closeActionsMenu()" class="dropdown-item">
          <span class="item-icon">â†—ï¸</span>
          <span class="item-text">Partager</span>
          <span class="item-badge">Pro</span>
        </button>
        <button (click)="createBackup(); closeActionsMenu()" class="dropdown-item">
          <span class="item-icon">ğŸ’¾</span>
          <span class="item-text">Sauvegarder</span>
        </button>
      </div>

      <div class="dropdown-section">
        <h6 class="section-title">AvancÃ©</h6>
        <button (click)="openJsonManager(); closeActionsMenu()" class="dropdown-item">
          <span class="item-icon">ğŸ“</span>
          <span class="item-text">Gestion JSON</span>
        </button>
        <button (click)="importFromGedcom(); closeActionsMenu()" class="dropdown-item">
          <span class="item-icon">ğŸ“¤</span>
          <span class="item-text">Importer GEDCOM</span>
        </button>
        <button (click)="clearAllData(); closeActionsMenu()" class="dropdown-item dropdown-danger">
          <span class="item-icon">ğŸ—‘ï¸</span>
          <span class="item-text">Tout effacer</span>
        </button>
      </div>

      <div class="dropdown-footer">
        <span class="footer-text">Version 2.0</span>
        <span class="footer-stats">{{ families.length }} familles</span>
      </div>
    </div>
  </div>

  <app-json-manager
    *ngIf="showJsonManager"
    (close)="closeJsonManager()"
  ></app-json-manager>
</div>

<!-- Modal de personne -->
<app-person-modal
  [show]="showPersonModal"
  [editingPerson]="editingPerson"
  [parentName]="parentForNewChild ? parentForNewChild.prenom + ' ' + parentForNewChild.nom : ''"
  (close)="closePersonModal()"
  (save)="onPersonFormSubmit($event)"
></app-person-modal>
