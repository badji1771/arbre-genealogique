<div class="app-container modern-home" [class.sidebar-collapsed]="sidebarCollapsed">
  <app-header
    [selectedFamily]="selectedFamily"
    [sidebarCollapsed]="sidebarCollapsed"
    [maxLevel]="maxLevel"
    (toggleSidebar)="toggleSidebar()"
    (triggerImport)="triggerImport()"
    (showGuide)="showGuide()"
    (openJsonManager)="openJsonManager()"
  ></app-header>

  <!-- Contenu principal redessin√© -->
  <main class="modern-main">
    <app-sidebar
      [families]="families"
      [selectedFamily]="selectedFamily"
      [showAddFamily]="showAddFamily"
      [newFamilyName]="newFamilyName"
      [collapsed]="sidebarCollapsed"
      [totalMembersAllFamilies]="getTotalMembersAllFamilies()"
      [totalGenerations]="getTotalGenerations()"
      (selectFamily)="selectFamily($event)"
      (toggleAddFamily)="showAddFamily = !showAddFamily"
      (addNewFamily)="newFamilyName = $event; addNewFamily()"
      (quickView)="quickView($event)"
      (toggleSidebar)="toggleSidebar()"
    ></app-sidebar>

    <!-- Zone centrale principale -->
    <section class="main-content">
      <!-- Vue d'accueil am√©lior√©e -->
      <div *ngIf="!selectedFamily" class="welcome-dashboard">
        <div class="dashboard-hero">
          <div class="hero-content">
            <div class="hero-animation">
              <div class="family-tree-animation">
                <div class="tree">
                  <div class="level" *ngFor="let level of [1,2,3,4]"></div>
                </div>
                <div class="members">
                  <div class="member" style="top: 20%; left: 50%;"><i class="fas fa-user-tie"></i></div>
                  <div class="member" style="top: 40%; left: 30%;"><i class="fas fa-user"></i></div>
                  <div class="member" style="top: 40%; left: 70%;"><i class="fas fa-user-ninja"></i></div>
                  <div class="member" style="top: 60%; left: 20%;"><i class="fas fa-child"></i></div>
                  <div class="member" style="top: 60%; left: 50%;"><i class="fas fa-child-reaching"></i></div>
                  <div class="member" style="top: 60%; left: 80%;"><i class="fas fa-baby"></i></div>
                </div>
              </div>
            </div>

            <div class="hero-text">
              <h2>Pr√©servez votre h√©ritage familial</h2>
              <p class="hero-description">
                Cr√©ez, visualisez et partagez votre arbre g√©n√©alogique
                avec une interface moderne et intuitive
              </p>

              <div class="hero-actions">
                <button (click)="createFirstFamily()" class="btn-hero-primary">
                  <span class="btn-icon"><i class="fas fa-tree"></i></span>
                  D√©marrer mon arbre
                </button>
                <button (click)="openSample()" class="btn-hero-secondary">
                  <span class="btn-icon"><i class="fas fa-eye"></i></span>
                  Voir un exemple
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Fonctionnalit√©s principales -->
        <div class="features-grid">
          <div class="feature-card">
            <div class="feature-icon"><i class="fas fa-users"></i></div>
            <h4>Ajout intuitif</h4>
            <p>Ajoutez des membres facilement avec des formulaires intelligents</p>
          </div>

          <div class="feature-card">
            <div class="feature-icon"><i class="fas fa-file-export"></i></div>
            <h4>Export complet</h4>
            <p>Exportez vos donn√©es en Excel, PDF et JSON</p>
          </div>

          <div class="feature-card">
            <div class="feature-icon"><i class="fas fa-paint-brush"></i></div>
            <h4>Visualisation</h4>
            <p>Plusieurs vues pour explorer votre arbre</p>
          </div>

          <div class="feature-card">
            <div class="feature-icon"><i class="fas fa-mobile-alt"></i></div>
            <h4>Multi-plateforme</h4>
            <p>Acc√©dez √† votre arbre depuis tous vos appareils</p>
          </div>
        </div>

        <!-- D√©marrage rapide -->
        <div class="quick-start">
          <h3>Commencez rapidement</h3>
          <div class="quick-options">
            <button class="quick-option" (click)="startWithTemplate('simple')">
              <span class="option-icon"><i class="fas fa-seedling"></i></span>
              <div class="option-content">
                <h5>Arbre simple</h5>
                <p>D√©marrez avec une structure basique</p>
              </div>
              <span class="option-arrow"><i class="fas fa-arrow-right"></i></span>
            </button>

            <button class="quick-option" (click)="importFromGedcom()">
              <span class="option-icon"><i class="fas fa-upload"></i></span>
              <div class="option-content">
                <h5>Importer GEDCOM</h5>
                <p>Importez un arbre existant</p>
              </div>
              <span class="option-arrow"><i class="fas fa-arrow-right"></i></span>
            </button>

            <button class="quick-option" (click)="openTutorial()">
              <span class="option-icon"><i class="fas fa-graduation-cap"></i></span>
              <div class="option-content">
                <h5>Guide pas √† pas</h5>
                <p>Apprenez √† cr√©er votre arbre</p>
              </div>
              <span class="option-arrow"><i class="fas fa-arrow-right"></i></span>
            </button>
          </div>
        </div>
      </div>

      <!-- Vue famille s√©lectionn√©e -->
      <div *ngIf="selectedFamily" class="family-dashboard">
        <!-- En-t√™te famille -->
        <div class="family-header">
          <div class="header-main">
            <div class="breadcrumb">
              <span class="crumb" (click)="selectedFamily = null">Familles</span>
              <span class="separator">‚Ä∫</span>
              <span class="crumb active">{{ selectedFamily.name }}</span>
            </div>

            <!-- Dans la section header-actions du family-header -->
            <div class="header-actions">
              <!-- Bouton Ajouter un membre am√©lior√© -->
              <div class="add-member-container">
                <button
                  (click)="openAddPersonModal()"
                  class="btn-add-member"
                >
                  <div class="btn-add-content">
                    <span class="btn-add-icon"><i class="fas fa-user-plus"></i></span>
                    <div class="btn-add-text">
                      <span class="btn-add-title">Ajouter un membre</span>
                      <span class="btn-add-subtitle">Cliquez pour ajouter</span>
                    </div>
                    <span class="btn-add-arrow"><i class="fas fa-plus"></i></span>
                  </div>
                  <div class="btn-add-glow"></div>
                </button>

                <!-- Menu rapide d'ajout (optionnel) -->
                <div class="quick-add-menu">
                  <button (click)="openAddPersonModal()" class="quick-add-item">
                    <span class="quick-add-icon"><i class="fas fa-user"></i></span>
                    <span class="quick-add-label">Personne seule</span>
                  </button>
                  <button (click)="openAddPersonModal()" class="quick-add-item">
                    <span class="quick-add-icon"><i class="fas fa-users"></i></span>
                    <span class="quick-add-label">Famille</span>
                  </button>
                  <button (click)="openAddPersonModal()" class="quick-add-item">
                    <span class="quick-add-icon"><i class="fas fa-baby"></i></span>
                    <span class="quick-add-label">Enfant</span>
                  </button>
                </div>
              </div>

              <!-- Bouton Actions avec ouverture au clic -->
              <div class="actions-container" [class.has-open-menu]="isActionsMenuOpen">
                <button class="btn-actions"
                        (click)="toggleActionsMenu($event)"
                        [class.active]="isActionsMenuOpen">
                  <div class="btn-actions-content">
                    <span class="btn-actions-icon"><i class="fas fa-bolt"></i></span>
                    <span class="btn-actions-text">Actions</span>
                    <span class="btn-actions-arrow"><i class="fas fa-chevron-down"></i></span>
                  </div>
                </button>
              </div>
            </div>
          </div>

          <!-- Statistiques famille -->
          <div class="family-stats">
            <div class="stat-card">
              <div class="stat-trend" [class.positive]="getGrowthTrend() > 0">
                <i class="fas" [class.fa-arrow-trend-up]="getGrowthTrend() > 0" [class.fa-minus]="getGrowthTrend() <= 0"></i>
              </div>
              <div class="stat-main">
                <div class="stat-value">{{ selectedFamily.members.length }}</div>
                <div class="stat-label">Membres</div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-main">
                <div class="stat-value">{{ maxLevel + 1 }}</div>
                <div class="stat-label">G√©n√©rations</div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-main">
                <div class="stat-value">{{ getGenderCount('homme') }}</div>
                <div class="stat-label">Hommes</div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-main">
                <div class="stat-value">{{ getGenderCount('femme') }}</div>
                <div class="stat-label">Femmes</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Vues de l'arbre -->
        <div class="view-controls-container">
          <div class="view-selector-group">
            <!-- S√©lecteur de vue principal -->
            <div class="view-picker">
              <span class="view-picker-label">Vue :</span>
              <div class="view-picker-buttons">
                <button
                  class="view-picker-btn"
                  [class.active]="currentView === 'tree'"
                  (click)="setView('tree')"
                  data-view="tree"
                  title="Vue arbre classique"
                >
                  <span class="view-icon"><i class="fas fa-sitemap"></i></span>
                  <span class="view-label">Arbre</span>
                  <span class="view-badge" *ngIf="getVisibleLevelsCount()">
            {{ getVisibleLevelsCount() }}
          </span>
                </button>

                <button
                  class="view-picker-btn"
                  [class.active]="currentView === 'list'"
                  (click)="setView('list')"
                  data-view="list"
                  title="Vue liste des membres"
                >
                  <span class="view-icon"><i class="fas fa-list-ul"></i></span>
                  <span class="view-label">Liste</span>
                  <span class="view-badge">{{ getAllMembersFlat().length }}</span>
                </button>

                <button
                  class="view-picker-btn coming-soon"
                  [class.active]="currentView === 'timeline'"
                  (click)="setView('timeline')"
                  data-view="timeline"
                  title="Vue chronologique (bient√¥t)"
                >
                  <span class="view-icon"><i class="fas fa-calendar-alt"></i></span>
                  <span class="view-label">Chronologie</span>
                  <span class="view-badge"><i class="fas fa-hammer"></i></span>
                </button>

                <button
                  class="view-picker-btn coming-soon"
                  [class.active]="currentView === 'map'"
                  (click)="setView('map')"
                  data-view="map"
                  title="Vue carte g√©ographique (bient√¥t)"
                >
                  <span class="view-icon"><i class="fas fa-map-marked-alt"></i></span>
                  <span class="view-label">Carte</span>
                  <span class="view-badge"><i class="fas fa-hammer"></i></span>
                </button>
              </div>
            </div>

            <!-- Contr√¥les d'expansion/contraction -->
            <div class="expansion-controls">
              <!-- Groupe compact pour les deux boutons -->
              <div class="expansion-group compact">
                <button
                  class="expansion-btn btn-expand-all"
                  (click)="expandAll()"
                  [disabled]="!selectedFamily || selectedFamily.members.length === 0"
                  title="Tout d√©velopper (Ctrl + E)"
                >
                  <span class="expansion-icon"><i class="fas fa-expand-arrows-alt"></i></span>
                  <span class="expansion-label">Ouvrir tout</span>
                </button>

                <button
                  class="expansion-btn btn-collapse-all"
                  (click)="collapseAll()"
                  [disabled]="!selectedFamily || selectedFamily.members.length === 0"
                  title="Tout r√©duire (Ctrl + C)"
                >
                  <span class="expansion-icon"><i class="fas fa-compress-arrows-alt"></i></span>
                  <span class="expansion-label">Fermer tout</span>
                </button>
              </div>

              <!-- Indicateur d'√©tat -->
              <div class="expansion-state" *ngIf="selectedFamily">
                <div class="state-indicator">
                  <div class="state-bar">
                    <div class="state-fill" [style.width.%]="getExpansionProgress()"></div>
                  </div>
                  <span class="state-text">
        {{ getExpandedLevelsCount() }}/{{ maxLevel + 1 }} g√©n√©rations
      </span>
                </div>
              </div>
            </div>

            <!-- Options rapides pour l'arbre -->
            <div class="quick-controls" *ngIf="currentView === 'tree' && selectedFamily">
              <button
                class="quick-btn"
                (click)="toggleShowAllGenerations()"
                [class.active]="showAllGenerations"
                title="Basculer l'affichage des g√©n√©rations"
              >
                <span class="quick-icon"><i class="fas" [class.fa-eye]="showAllGenerations" [class.fa-eye-slash]="!showAllGenerations"></i></span>
                <span class="quick-label">
          {{ showAllGenerations ? 'Toutes' : 'S√©lectives' }}
        </span>
              </button>

              <button
                class="quick-btn"
                (click)="scrollToGeneration(0)"
                [disabled]="!hasMembersInLevel(0)"
                title="Aller aux fondateurs"
              >
                <span class="quick-icon"><i class="fas fa-crown"></i></span>
                <span class="quick-label">Fondateurs</span>
              </button>

              <button
                class="quick-btn"
                (click)="scrollToGeneration(maxLevel)"
                [disabled]="!hasMembersInLevel(maxLevel)"
                title="Aller √† la derni√®re g√©n√©ration"
              >
                <span class="quick-icon"><i class="fas fa-baby"></i></span>
                <span class="quick-label">Derni√®re</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Contenu de la vue -->
        <div class="view-content">
          <div *ngIf="selectedFamily.members.length === 0" class="empty-family">
            <div class="empty-illustration">
              <div class="illustration-content">
                <div class="tree-placeholder">
                  <div class="trunk"></div>
                  <div class="branches">
                    <div class="branch"></div>
                    <div class="branch"></div>
                    <div class="branch"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="empty-message">
              <h3>Votre arbre est vide</h3>
              <p>Ajoutez le premier membre pour commencer √† construire votre histoire familiale</p>
              <button (click)="openAddPersonModal()" class="btn-start-tree">
                <span class="btn-icon"><i class="fas fa-crown"></i></span>
                Ajouter le fondateur
              </button>
            </div>
          </div>

          <!-- Vue arbre g√©n√©alogique -->
          <ng-container *ngIf="getFamilyMemberCount(selectedFamily!) > 0 && currentView === 'tree'">
            <div class="tree-view modern-tree" #treeContainer>
              <div class="tree-wrapper">
                <!-- Barre lat√©rale des g√©n√©rations -->
                <div class="generation-sidebar">
                  <div
                    *ngFor="let level of getGenerationLevels()"
                    class="generation-marker"
                    [class.visible]="!isLevelCollapsed(level)"
                    (click)="scrollToGeneration(level)"
                    [title]="getLevelInfo(level)"
                  >
                    <span class="marker-number">G{{ level + 1 }}</span>
                    <span class="marker-line"></span>
                  </div>
                </div>

                <!-- Contenu des g√©n√©rations -->
                <div class="generations-content">
                  <div
                    *ngFor="let level of getGenerationLevels()"
                    [id]="'generation-' + level"
                    class="generation-level"
                    [class.collapsed]="isLevelCollapsed(level)"
                  >
                    <!-- En-t√™te de g√©n√©ration -->
                    <div *ngIf="!isLevelCollapsed(level)" class="level-header">
                      <div class="level-title">
                        <span class="title-icon"><i [class]="getGenerationIcon(level)"></i></span>
                        <h3>{{ getGenerationTitle(level) }}</h3>
                        <span class="level-count">{{ getMemberCountByLevel(level) }} membre(s)</span>
                      </div>
                      <button (click)="toggleLevel(level)" class="btn-toggle">
                        <i class="fas" [class.fa-eye]="isLevelCollapsed(level)" [class.fa-eye-slash]="!isLevelCollapsed(level)"></i>
                        {{ isLevelCollapsed(level) ? ' Afficher' : ' Masquer' }}
                      </button>
                    </div>

                    <!-- Contenu de g√©n√©ration -->
                    <div *ngIf="!isLevelCollapsed(level)" class="level-content">
                      <div class="members-grid">
                        <ng-container *ngFor="let node of getNodesByLevel(level)">
                          <div class="member-node">
                            <!-- Connexion parent -->
                            <div *ngIf="level > 0" class="parent-connection">
                              <div class="connection-line"></div>
                              <div class="connection-arrow"><i class="fas fa-arrow-down"></i></div>
                            </div>

                            <!-- Carte personne -->
                            <app-person-card
                              [person]="node.person"
                              [isSelected]="node.isSelected"
                              [generation]="level"
                              (select)="selectedPerson = $event"
                              (addChild)="openAddPersonModal($event)"
                              (edit)="openEditPersonModal($event)"
                              (delete)="deletePerson($event)"
                              (viewDetails)="onViewDetails($event)"
                            ></app-person-card>

                            <!-- Indicateur enfants -->
                            <div
                              *ngIf="node.children && node.children.length > 0"
                              class="children-indicator"
                              (click)="scrollToGeneration(level + 1)"
                            >
                              <span class="indicator-icon">‚¨áÔ∏è</span>
                              <span class="indicator-text">{{ node.children.length }} enfant(s)</span>
                            </div>
                          </div>
                        </ng-container>
                      </div>

                      <!-- G√©n√©ration vide -->
                      <div *ngIf="getMemberCountByLevel(level) === 0" class="empty-generation">
                        <span class="empty-icon">üë•</span>
                        <p>Aucun membre dans cette g√©n√©ration</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>

          <!-- Vue liste -->
          <ng-container *ngIf="getFamilyMemberCount(selectedFamily!) > 0 && currentView === 'list'">
            <div class="list-view">
              <div class="list-header">
                <h3>Liste des membres</h3>
                <div class="list-stats">
                  {{ getTotalMembers(selectedFamily) }} membres
                </div>
              </div>
              <div class="members-list">
                <div *ngFor="let person of getAllMembersFlat()" class="list-item">
                  <div class="list-item-avatar">
                    {{ person.prenom.charAt(0) }}{{ person.nom.charAt(0) }}
                  </div>
                  <div class="list-item-content">
                    <h4>{{ person.prenom }} {{ person.nom }}</h4>
                    <div class="list-item-meta">
                      <span class="meta-item">{{ person.genre === 'homme' ? 'üë®' : 'üë©' }}</span>
                      <span class="meta-item">G{{ getPersonGeneration(person) + 1 }}</span>
                      <span *ngIf="person.telephone" class="meta-item">üì± {{ person.telephone }}</span>
                    </div>
                  </div>
                  <div class="list-item-actions">
                    <button (click)="onViewDetails(person)" class="btn-action">üëÅÔ∏è</button>
                    <button (click)="openEditPersonModal(person)" class="btn-action">‚úèÔ∏è</button>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>

          <!-- Vue chronologie -->
          <ng-container *ngIf="selectedFamily.members.length > 0 && currentView === 'timeline'">
            <div class="timeline-view">
              <div class="timeline-empty">
                <div class="empty-icon">üìÖ</div>
                <h3>Chronologie</h3>
                <p>Fonctionnalit√© √† venir</p>
              </div>
            </div>
          </ng-container>

          <!-- Vue carte -->
          <ng-container *ngIf="selectedFamily.members.length > 0 && currentView === 'map'">
            <div class="map-view">
              <div class="map-empty">
                <div class="empty-icon">üó∫Ô∏è</div>
                <h3>Carte g√©ographique</h3>
                <p>Fonctionnalit√© √† venir</p>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </section>
  </main>

    <!-- Composant de guide (overlay modal) -->
    <app-guide #guideComponent></app-guide>

  <!-- Barre lat√©rale contextuelle des d√©tails personne -->
  <aside class="context-sidebar" [class.visible]="selectedPerson">
    <div *ngIf="selectedPerson" class="sidebar-content">
      <!-- En-t√™te avec fond color√© -->
      <div class="sidebar-header" [class]="selectedPerson.genre === 'homme' ? 'header-man' : 'header-woman'">
        <div class="header-content">
          <h3>
            <span class="header-icon">üìã</span>
            D√©tails du membre
          </h3>
          <p class="header-subtitle">{{ selectedPerson.prenom }} {{ selectedPerson.nom }}</p>
        </div>
        <div class="header-actions">
          <button (click)="openEditPersonModal(selectedPerson)" class="header-btn" title="Modifier">
            <span class="btn-icon">‚úèÔ∏è</span>
            Modifier
          </button>
          <button (click)="selectedPerson = null" class="header-btn header-close" title="Fermer">
            ‚úï
          </button>
        </div>
      </div>

      <div class="person-details">
        <!-- Carte profil avec photo/avatar -->
        <div class="profile-card">
          <div class="profile-avatar" [class]="selectedPerson.genre === 'homme' ? 'avatar-man' : 'avatar-woman'">
            <div *ngIf="!selectedPerson.photo" class="avatar-initials">
              {{ getPersonDetails(selectedPerson).initials }}
            </div>
            <img *ngIf="selectedPerson.photo"
                 [src]="selectedPerson.photo"
                 [alt]="selectedPerson.prenom + ' ' + selectedPerson.nom"
                 class="avatar-photo">
            <div class="avatar-badge">
              {{ selectedPerson.genre === 'homme' ? 'üë®' : 'üë©' }}
            </div>
          </div>

          <div class="profile-info">
            <h4 class="profile-name">{{ selectedPerson.prenom }} {{ selectedPerson.nom }}</h4>
            <div class="profile-meta">
            <span class="meta-badge generation-badge">
              <span class="meta-icon">üå≥</span>
              G√©n√©ration {{ getPersonGeneration(selectedPerson) + 1 }}
            </span>
              <span class="meta-badge id-badge">
              <span class="meta-icon">üÜî</span>
              ID: {{ selectedPerson.id }}
            </span>
            </div>

            <!-- M√©triques rapides -->
            <div class="profile-stats">
              <div class="stat-item">
                <div class="stat-icon">üë∂</div>
                <div class="stat-details">
                  <div class="stat-value">{{ selectedPerson.children?.length || 0 }}</div>
                  <div class="stat-label">Enfants</div>
                </div>
              </div>
              <div class="stat-item">
                <div class="stat-icon">üéÇ</div>
                <div class="stat-details">
                  <div class="stat-value">{{ getAgeFromDate(selectedPerson.dateNaissance) || '?' }}</div>
                  <div class="stat-label">√Çge</div>
                </div>
              </div>
              <div class="stat-item">
                <div class="stat-icon">üíº</div>
                <div class="stat-details">
                  <div class="stat-value">{{ selectedPerson.profession ? 'Oui' : 'Non' }}</div>
                  <div class="stat-label">Profession</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions principales avec boutons color√©s -->
        <div class="quick-actions-section">
          <h5 class="section-title">
            <span class="section-icon">‚ö°</span>
            Actions rapides
          </h5>
          <div class="actions-grid">
            <button (click)="openAddPersonModal(selectedPerson)" class="action-btn btn-primary">
              <span class="action-icon">üë∂</span>
              <span class="action-text">Ajouter un enfant</span>
              <span class="action-arrow">‚Üí</span>
            </button>

            <button (click)="openEditPersonModal(selectedPerson)" class="action-btn btn-secondary">
              <span class="action-icon">‚úèÔ∏è</span>
              <span class="action-text">Modifier</span>
              <span class="action-arrow">‚Üí</span>
            </button>

            <button (click)="downloadPersonPhoto(selectedPerson)"
                    [disabled]="!selectedPerson.photo"
                    class="action-btn btn-success">
              <span class="action-icon">üì•</span>
              <span class="action-text">T√©l√©charger photo</span>
              <span class="action-arrow">‚Üí</span>
            </button>

            <button (click)="sharePerson(selectedPerson)" class="action-btn btn-info">
              <span class="action-icon">‚ÜóÔ∏è</span>
              <span class="action-text">Partager</span>
              <span class="action-arrow">‚Üí</span>
            </button>
          </div>
        </div>

        <!-- Informations de contact -->
        <div class="contact-section" *ngIf="selectedPerson.telephone || selectedPerson.email || selectedPerson.adresse">
          <h5 class="section-title">
            <span class="section-icon">üìû</span>
            Contact
          </h5>
          <div class="contact-list">
            <div *ngIf="selectedPerson.telephone" class="contact-item">
              <div class="contact-icon-wrapper phone">
                <span class="contact-icon">üì±</span>
              </div>
              <div class="contact-details">
                <span class="contact-label">T√©l√©phone</span>
                <a [href]="'tel:' + selectedPerson.telephone" class="contact-value">
                  {{ selectedPerson.telephone }}
                </a>
              </div>
              <button (click)="copyToClipboard(selectedPerson.telephone)" class="contact-action" title="Copier">
                üìã
              </button>
            </div>

            <div *ngIf="selectedPerson.email" class="contact-item">
              <div class="contact-icon-wrapper email">
                <span class="contact-icon">üìß</span>
              </div>
              <div class="contact-details">
                <span class="contact-label">Email</span>
                <a [href]="'mailto:' + selectedPerson.email" class="contact-value">
                  {{ selectedPerson.email }}
                </a>
              </div>
              <button (click)="copyToClipboard(selectedPerson.email)" class="contact-action" title="Copier">
                üìã
              </button>
            </div>

            <div *ngIf="selectedPerson.adresse" class="contact-item">
              <div class="contact-icon-wrapper address">
                <span class="contact-icon">üìç</span>
              </div>
              <div class="contact-details">
                <span class="contact-label">Adresse</span>
                <span class="contact-value">{{ selectedPerson.adresse }}</span>
              </div>
              <button (click)="openMap(selectedPerson.adresse)" class="contact-action" title="Voir sur carte">
                üó∫Ô∏è
              </button>
            </div>
          </div>
        </div>

        <!-- Famille -->
        <div class="family-section">
          <!-- Enfants -->
          <div *ngIf="selectedPerson.children && selectedPerson.children.length > 0" class="family-relations">
            <h5 class="section-title">
              <span class="section-icon">üë∂</span>
              Enfants ({{ selectedPerson.children.length }})
            </h5>
            <div class="children-list">
              <div *ngFor="let child of selectedPerson.children"
                   class="child-item"
                   (click)="selectedPerson = child">
                <div class="child-avatar" [class]="child.genre === 'homme' ? 'child-boy' : 'child-girl'">
                  {{ child.prenom.charAt(0) }}{{ child.nom.charAt(0) }}
                </div>
                <div class="child-info">
                  <span class="child-name">{{ child.prenom }} {{ child.nom }}</span>
                  <div class="child-meta">
                    <span class="child-gender">{{ child.genre === 'homme' ? 'üë¶' : 'üëß' }}</span>
                    <span class="child-age">{{ getAgeFromDate(child.dateNaissance) || '?' }} ans</span>
                  </div>
                </div>
                <button class="child-action" title="Voir">
                  üëÅÔ∏è
                </button>
              </div>
            </div>
          </div>

          <!-- Parent -->
          <div *ngIf="selectedPerson.parentId" class="family-relations">
            <h5 class="section-title">
              <span class="section-icon">üë§</span>
              Parent
            </h5>
            <div class="parent-item" (click)="navigateToParent(selectedPerson.parentId)">
              <div class="parent-avatar">üë®‚Äçüë©‚Äçüë¶</div>
              <div class="parent-info">
                <span class="parent-name">{{ getParentName(selectedPerson.parentId) }}</span>
                <span class="parent-relation">Parent</span>
              </div>
              <button class="parent-action" title="Voir le parent">
                ‚ÜóÔ∏è
              </button>
            </div>
          </div>
        </div>

        <!-- Notes -->
        <div *ngIf="selectedPerson.notes" class="notes-section">
          <h5 class="section-title">
            <span class="section-icon">üìù</span>
            Notes
          </h5>
          <div class="notes-content">
            {{ selectedPerson.notes }}
          </div>
        </div>

        <!-- Boutons d'action secondaires -->
        <div class="secondary-actions">
          <button (click)="duplicatePerson(selectedPerson)" class="secondary-btn btn-warning">
            <span class="btn-icon">‚éò</span>
            Dupliquer
          </button>
          <button (click)="exportPersonData(selectedPerson)" class="secondary-btn btn-info">
            <span class="btn-icon">üìÑ</span>
            Exporter fiche
          </button>
          <button (click)="deletePerson(selectedPerson.id)" class="secondary-btn btn-danger">
            <span class="btn-icon">üóëÔ∏è</span>
            Supprimer
          </button>
        </div>
      </div>
    </div>
  </aside>

  <!-- Navigation rapide -->
  <nav class="quick-nav">
    <button class="nav-btn" (click)="scrollToTop()" title="Haut">
      <span class="nav-icon">‚Üë</span>
    </button>
    <div class="nav-separator"></div>
    <button class="nav-btn" (click)="toggleSidebar()" [title]="sidebarCollapsed ? 'Afficher la barre lat√©rale' : 'Masquer la barre lat√©rale'">
      <span class="nav-icon">{{ sidebarCollapsed ? '‚û°Ô∏è' : 'üè†' }}</span>
    </button>
    <div class="nav-separator"></div>
    <button class="nav-btn" (click)="addQuickPerson()" title="Ajouter rapidement">
      <span class="nav-icon">+</span>
    </button>
    <div class="nav-separator"></div>
    <button class="nav-btn" (click)="searchPersons()" title="Rechercher">
      <span class="nav-icon">üîç</span>
    </button>
    <div class="nav-separator"></div>
    <button class="nav-btn" (click)="scrollToBottom()" title="Bas">
      <span class="nav-icon">‚Üì</span>
    </button>
  </nav>

  <!-- Notifications toast -->
  <div class="toast-container">
    <div *ngFor="let toast of toastService.toasts$ | async" class="toast" [class]="toast.type">
      <span class="toast-icon">{{ toast.icon }}</span>
      <span class="toast-message">{{ toast.message }}</span>
      <button class="toast-close" (click)="toastService.dismiss(toast.id)">√ó</button>
    </div>
  </div>

  <!-- Modal de confirmation g√©n√©rique -->
  <app-confirmation-modal></app-confirmation-modal>

  <!-- Menu Actions (plac√© √† la racine pour le z-index) -->
  <div class="actions-dropdown-overlay" #globalDropdown (click)="closeActionsMenu($event)"
       [class.visible]="isActionsMenuOpen">
    <div class="actions-dropdown-content" (click)="$event.stopPropagation()">
      <!-- Bouton de fermeture -->
      <button class="dropdown-close-btn" (click)="closeActionsMenu($event)" title="Fermer">
        ‚úï
      </button>

      <!-- En-t√™te du menu -->
      <div class="dropdown-header">
        <span class="dropdown-icon">üìã</span>
        <span class="dropdown-title">Actions rapides</span>
      </div>

      <!-- Sections du menu -->
      <div class="dropdown-section">
        <h6 class="section-title">Export</h6>
        <button (click)="exportCurrentFamily(); closeActionsMenu()" class="dropdown-item">
          <span class="item-icon">üìä</span>
          <span class="item-text">Exporter Excel</span>
          <span class="item-badge">Nouveau</span>
        </button>
        <button (click)="exportToJson(); closeActionsMenu()" class="dropdown-item">
          <span class="item-icon">üíæ</span>
          <span class="item-text">Exporter JSON</span>
        </button>
        <button (click)="exportStatistics(); closeActionsMenu()" class="dropdown-item">
          <span class="item-icon">üìà</span>
          <span class="item-text">Statistiques</span>
        </button>
      </div>

      <div class="dropdown-section">
        <h6 class="section-title">Gestion</h6>
        <button (click)="duplicateFamily(); closeActionsMenu()" class="dropdown-item">
          <span class="item-icon">‚éò</span>
          <span class="item-text">Dupliquer famille</span>
        </button>
        <button (click)="shareFamilyViaMenu(); closeActionsMenu()" class="dropdown-item">
          <span class="item-icon">‚ÜóÔ∏è</span>
          <span class="item-text">Partager</span>
          <span class="item-badge">Pro</span>
        </button>
        <button (click)="createBackup(); closeActionsMenu()" class="dropdown-item">
          <span class="item-icon">üíæ</span>
          <span class="item-text">Sauvegarder</span>
        </button>
      </div>

      <div class="dropdown-section">
        <h6 class="section-title">Avanc√©</h6>
        <button (click)="openJsonManager(); closeActionsMenu()" class="dropdown-item">
          <span class="item-icon">üìÅ</span>
          <span class="item-text">Gestion JSON</span>
        </button>
        <button (click)="importFromGedcom(); closeActionsMenu()" class="dropdown-item">
          <span class="item-icon">üì§</span>
          <span class="item-text">Importer GEDCOM</span>
        </button>
        <button (click)="clearAllData(); closeActionsMenu()" class="dropdown-item dropdown-danger">
          <span class="item-icon">üóëÔ∏è</span>
          <span class="item-text">Tout effacer</span>
        </button>
      </div>

      <div class="dropdown-footer">
        <span class="footer-text">Version 2.0</span>
        <span class="footer-stats">{{ families.length }} familles</span>
      </div>
    </div>
  </div>

  <app-json-manager
    *ngIf="showJsonManager"
    (close)="closeJsonManager()"
  ></app-json-manager>
</div>

<!-- Modal de personne -->
<app-person-modal
  [show]="showPersonModal"
  [editingPerson]="editingPerson"
  [parentName]="parentForNewChild ? parentForNewChild.prenom + ' ' + parentForNewChild.nom : ''"
  (close)="closePersonModal()"
  (save)="onPersonFormSubmit($event)"
></app-person-modal>
